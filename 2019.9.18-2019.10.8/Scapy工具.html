<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Scapy工具</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="h0dy" id="scapy工具">Scapy工具</h1><p data-anchor-id="udmf"><code>实验</code></p><hr><div class="md-section-divider"></div><h3 data-anchor-id="6vzj" id="scapy的基本操作"><strong>Scapy的基本操作</strong></h3><p data-anchor-id="aatk">1、开始（使用 $scapy 操作启动）</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="626v"><ol class="linenums"><li class="L0"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> a</span><span class="pun">=</span><span class="pln">IP</span><span class="pun">(</span><span class="pln">ttl</span><span class="pun">=</span><span class="lit">10</span><span class="pun">)</span><span class="pln">    </span><span class="com">//创建一个IP数据包，TTL=10</span></code></li><li class="L1"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> a   </span><span class="com">//查看数据包a</span></code></li><li class="L2"><code><span class="pun">&lt;</span><span class="pln"> IP ttl</span><span class="pun">=</span><span class="lit">10</span><span class="pln"> </span><span class="pun">|&gt;</span></code></li><li class="L3"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">src   </span><span class="com">//查看a的源IP地址</span></code></li><li class="L4"><code><span class="pun">’</span><span class="lit">127.0</span><span class="pun">.</span><span class="lit">0.1</span><span class="pun">’</span></code></li><li class="L5"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">dst</span><span class="pun">=</span><span class="str">"192.168.1.1"</span><span class="pln"> </span><span class="com">//设置数据包a的目的IP地址</span></code></li><li class="L6"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> a</span></code></li><li class="L7"><code><span class="pun">&lt;</span><span class="pln"> IP ttl</span><span class="pun">=</span><span class="lit">10</span><span class="pln"> dst</span><span class="pun">=</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.1</span><span class="pln"> </span><span class="pun">|&gt;</span></code></li><li class="L8"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">src</span></code></li><li class="L9"><code><span class="pun">’</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">8.14</span><span class="pun">’</span></code></li><li class="L0"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="kwd">del</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">ttl</span><span class="pun">)</span><span class="pln">  </span><span class="com">//删除数据包a的TTL字段</span></code></li><li class="L1"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> a</span></code></li><li class="L2"><code><span class="pun">&lt;</span><span class="pln"> IP dst</span><span class="pun">=</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">1.1</span><span class="pln"> </span><span class="pun">|&gt;</span></code></li><li class="L3"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">ttl   </span><span class="com">//查看a的TTL字段</span></code></li><li class="L4"><code><span class="lit">64</span></code></li></ol></pre><p data-anchor-id="ojfr">2、对叠层（stacking layer） <br>
使用“/”操作实现嵌套。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="1z22"><ol class="linenums"><li class="L0"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> IP</span><span class="pun">()</span><span class="pln">    </span><span class="com">//创建一个IP数据包</span></code></li><li class="L1"><code><span class="pun">&lt;</span><span class="pln">IP </span><span class="pun">|&gt;</span></code></li><li class="L2"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> IP</span><span class="pun">()/</span><span class="pln">TCP</span><span class="pun">()</span><span class="pln">    </span><span class="com">//创建一个嵌套了TCP数据包的IP包</span></code></li><li class="L3"><code><span class="pun">&lt;</span><span class="pln">IP frag</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">TCP </span><span class="pun">|&lt;</span><span class="pln">TCP </span><span class="pun">|&gt;&gt;</span></code></li><li class="L4"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="typ">Ether</span><span class="pun">()/</span><span class="pln">IP</span><span class="pun">()/</span><span class="pln">TCP</span><span class="pun">()</span></code></li><li class="L5"><code><span class="pun">&lt;</span><span class="typ">Ether</span><span class="pln"> type</span><span class="pun">=</span><span class="lit">0x800</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">IP frag</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">TCP </span><span class="pun">|&lt;</span><span class="pln">TCP </span><span class="pun">|&gt;&gt;&gt;</span></code></li><li class="L6"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> IP</span><span class="pun">()/</span><span class="pln">TCP</span><span class="pun">()/</span><span class="str">"GET / HTTP/1.0\r\n\r\n"</span><span class="pln">     </span><span class="com">//创建一个嵌套了TCP数据包的IP包，TCP数据包内容为GET / HTTP/1.0\r\n\r\n </span></code></li><li class="L7"><code><span class="pun">&lt;</span><span class="pln">IP frag</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">TCP </span><span class="pun">|&lt;</span><span class="pln">TCP </span><span class="pun">|&lt;</span><span class="typ">Raw</span><span class="pln"> load</span><span class="pun">=</span><span class="str">'GET / HTTP/1.0\r\n\r\n'</span><span class="pln"> </span><span class="pun">|&gt;&gt;&gt;</span></code></li><li class="L8"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="typ">Ether</span><span class="pun">()/</span><span class="pln">IP</span><span class="pun">()/</span><span class="pln">IP</span><span class="pun">()/</span><span class="pln">UDP</span><span class="pun">()</span></code></li><li class="L9"><code><span class="pun">&lt;</span><span class="typ">Ether</span><span class="pln"> type</span><span class="pun">=</span><span class="lit">0x800</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">IP frag</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">IP </span><span class="pun">|&lt;</span><span class="pln">IP frag</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">UDP </span><span class="pun">|&lt;</span><span class="pln">UDP </span><span class="pun">|&gt;&gt;&gt;&gt;</span></code></li><li class="L0"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> IP</span><span class="pun">(</span><span class="pln">proto</span><span class="pun">=</span><span class="lit">55</span><span class="pun">)/</span><span class="pln">TCP</span><span class="pun">()</span><span class="pln">      </span><span class="com">//指定IP协议，即协议号为55的协议</span></code></li><li class="L1"><code><span class="pun">&lt;</span><span class="pln">IP frag</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> proto</span><span class="pun">=</span><span class="lit">55</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">TCP </span><span class="pun">|&gt;&gt;</span></code></li></ol></pre><p data-anchor-id="0pen">每个数据包都可以被封装或者解析，在python中“_”(下划线)一般表示最新结果。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="usz7"><ol class="linenums"><li class="L0"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> raw</span><span class="pun">(</span><span class="pln">IP</span><span class="pun">())</span><span class="pln">       </span><span class="com">//将新建的IP数据包以二进制形式展现</span></code></li><li class="L1"><code><span class="str">'E\x00\x00\x14\x00\x01\x00\x00@\x00|\xe7\x7f\x00\x00\x01\x7f\x00\x00\x01'</span></code></li><li class="L2"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> IP</span><span class="pun">(</span><span class="pln">_</span><span class="pun">)</span><span class="pln">       </span><span class="com">//以正常形式展现IP数据包</span></code></li><li class="L3"><code><span class="pun">&lt;</span><span class="pln">IP version</span><span class="pun">=</span><span class="lit">4L</span><span class="pln"> ihl</span><span class="pun">=</span><span class="lit">5L</span><span class="pln"> tos</span><span class="pun">=</span><span class="lit">0x0</span><span class="pln"> len</span><span class="pun">=</span><span class="lit">20</span><span class="pln"> id</span><span class="pun">=</span><span class="lit">1</span><span class="pln"> flags</span><span class="pun">=</span><span class="pln"> frag</span><span class="pun">=</span><span class="lit">0L</span><span class="pln"> ttl</span><span class="pun">=</span><span class="lit">64</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">IP</span></code></li><li class="L4"><code><span class="pln"> chksum</span><span class="pun">=</span><span class="lit">0x7ce7</span><span class="pln"> src</span><span class="pun">=</span><span class="lit">127.0</span><span class="pun">.</span><span class="lit">0.1</span><span class="pln"> dst</span><span class="pun">=</span><span class="lit">127.0</span><span class="pun">.</span><span class="lit">0.1</span><span class="pln"> </span><span class="pun">|&gt;</span></code></li><li class="L5"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln">  a</span><span class="pun">=</span><span class="typ">Ether</span><span class="pun">()/</span><span class="pln">IP</span><span class="pun">(</span><span class="pln">dst</span><span class="pun">=</span><span class="str">"www.slashdot.org"</span><span class="pun">)/</span><span class="pln">TCP</span><span class="pun">()/</span><span class="str">"GET /index.html HTTP/1.0 \n\n"</span><span class="pln">      </span><span class="com">//设置一个以太网数据包，并起名为a   </span></code></li><li class="L6"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln">  hexdump</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln">     </span><span class="com">//以十六进制展现数据包a</span></code></li><li class="L7"><code><span class="lit">00</span><span class="pln"> </span><span class="lit">02</span><span class="pln"> </span><span class="lit">15</span><span class="pln"> </span><span class="lit">37</span><span class="pln"> A2 </span><span class="lit">44</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> AE F3 </span><span class="lit">52</span><span class="pln"> AA D1 </span><span class="lit">08</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">45</span><span class="pln"> </span><span class="lit">00</span><span class="pln">  </span><span class="pun">...</span><span class="lit">7.D</span><span class="pun">...</span><span class="pln">R</span><span class="pun">....</span><span class="pln">E</span><span class="pun">.</span></code></li><li class="L8"><code><span class="lit">00</span><span class="pln"> </span><span class="lit">43</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">01</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">40</span><span class="pln"> </span><span class="lit">06</span><span class="pln"> </span><span class="lit">78</span><span class="pln"> </span><span class="lit">3C</span><span class="pln"> C0 A8 </span><span class="lit">05</span><span class="pln"> </span><span class="lit">15</span><span class="pln"> </span><span class="lit">42</span><span class="pln"> </span><span class="lit">23</span><span class="pln">  </span><span class="pun">.</span><span class="pln">C</span><span class="pun">....@.</span><span class="pln">x</span><span class="pun">&lt;....</span><span class="pln">B</span><span class="com">#</span></code></li><li class="L9"><code><span class="pln">FA </span><span class="lit">97</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">14</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">50</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">50</span><span class="pln"> </span><span class="lit">02</span><span class="pln">  </span><span class="pun">.....</span><span class="pln">P</span><span class="pun">........</span><span class="pln">P</span><span class="pun">.</span></code></li><li class="L0"><code><span class="lit">20</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> BB </span><span class="lit">39</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="lit">47</span><span class="pln"> </span><span class="lit">45</span><span class="pln"> </span><span class="lit">54</span><span class="pln"> </span><span class="lit">20</span><span class="pln"> </span><span class="lit">2F</span><span class="pln"> </span><span class="lit">69</span><span class="pln"> </span><span class="lit">6E</span><span class="pln"> </span><span class="lit">64</span><span class="pln"> </span><span class="lit">65</span><span class="pln"> </span><span class="lit">78</span><span class="pln">   </span><span class="pun">..</span><span class="lit">9.</span><span class="pun">.</span><span class="pln">GET </span><span class="pun">/</span><span class="pln">index</span></code></li><li class="L1"><code><span class="lit">2E</span><span class="pln"> </span><span class="lit">68</span><span class="pln"> </span><span class="lit">74</span><span class="pln"> </span><span class="lit">6D</span><span class="pln"> </span><span class="lit">6C</span><span class="pln"> </span><span class="lit">20</span><span class="pln"> </span><span class="lit">48</span><span class="pln"> </span><span class="lit">54</span><span class="pln"> </span><span class="lit">54</span><span class="pln"> </span><span class="lit">50</span><span class="pln"> </span><span class="lit">2F</span><span class="pln"> </span><span class="lit">31</span><span class="pln"> </span><span class="lit">2E</span><span class="pln"> </span><span class="lit">30</span><span class="pln"> </span><span class="lit">20</span><span class="pln"> </span><span class="lit">0A</span><span class="pln">  </span><span class="pun">.</span><span class="pln">html HTTP</span><span class="pun">/</span><span class="lit">1.0</span><span class="pln"> </span><span class="pun">.</span></code></li><li class="L2"><code><span class="lit">0A</span><span class="pln">                                               </span><span class="pun">.</span></code></li><li class="L3"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> b</span><span class="pun">=</span><span class="pln">raw</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln">        </span><span class="com">//将数据包a的二进制形式赋值给b</span></code></li><li class="L4"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> b       </span><span class="com">//显示b</span></code></li><li class="L5"><code><span class="str">'\x00\x02\x157\xa2D\x00\xae\xf3R\xaa\xd1\x08\x00E\x00\x00C\x00\x01\x00\x00@\x06x&lt;\xc0</span></code></li><li class="L6"><code><span class="str"> \xa8\x05\x15B#\xfa\x97\x00\x14\x00P\x00\x00\x00\x00\x00\x00\x00\x00P\x02 \x00</span></code></li><li class="L7"><code><span class="str"> \xbb9\x00\x00GET /index.html HTTP/1.0 \n\n'</span></code></li><li class="L8"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> c</span><span class="pun">=</span><span class="typ">Ether</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln">      </span><span class="com">//将b封装进以太网帧中，并起名为c</span></code></li><li class="L9"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> c       </span><span class="com">//显示数据包c，源MAC地址为本机的MAC地址，目的MAC地址为网关的MAC地址，源IP为本机的IP地址，目的IP为a设置的网址的IP地址</span></code></li><li class="L0"><code><span class="pun">&lt;</span><span class="typ">Ether</span><span class="pln"> dst</span><span class="pun">=</span><span class="lit">00</span><span class="pun">:</span><span class="lit">02</span><span class="pun">:</span><span class="lit">15</span><span class="pun">:</span><span class="lit">37</span><span class="pun">:</span><span class="pln">a2</span><span class="pun">:</span><span class="lit">44</span><span class="pln"> src</span><span class="pun">=</span><span class="lit">00</span><span class="pun">:</span><span class="pln">ae</span><span class="pun">:</span><span class="pln">f3</span><span class="pun">:</span><span class="lit">52</span><span class="pun">:</span><span class="pln">aa</span><span class="pun">:</span><span class="pln">d1 type</span><span class="pun">=</span><span class="lit">0x800</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">IP version</span><span class="pun">=</span><span class="lit">4L</span></code></li><li class="L1"><code><span class="pln"> ihl</span><span class="pun">=</span><span class="lit">5L</span><span class="pln"> tos</span><span class="pun">=</span><span class="lit">0x0</span><span class="pln"> len</span><span class="pun">=</span><span class="lit">67</span><span class="pln"> id</span><span class="pun">=</span><span class="lit">1</span><span class="pln"> flags</span><span class="pun">=</span><span class="pln"> frag</span><span class="pun">=</span><span class="lit">0L</span><span class="pln"> ttl</span><span class="pun">=</span><span class="lit">64</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">TCP chksum</span><span class="pun">=</span><span class="lit">0x783c</span></code></li><li class="L2"><code><span class="pln"> src</span><span class="pun">=</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">5.21</span><span class="pln"> dst</span><span class="pun">=</span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.151</span><span class="pln"> options</span><span class="pun">=</span><span class="str">''</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">TCP sport</span><span class="pun">=</span><span class="lit">20</span><span class="pln"> dport</span><span class="pun">=</span><span class="lit">80</span><span class="pln"> seq</span><span class="pun">=</span><span class="lit">0L</span></code></li><li class="L3"><code><span class="pln"> ack</span><span class="pun">=</span><span class="lit">0L</span><span class="pln"> dataofs</span><span class="pun">=</span><span class="lit">5L</span><span class="pln"> reserved</span><span class="pun">=</span><span class="lit">0L</span><span class="pln"> flags</span><span class="pun">=</span><span class="pln">S window</span><span class="pun">=</span><span class="lit">8192</span><span class="pln"> chksum</span><span class="pun">=</span><span class="lit">0xbb39</span><span class="pln"> urgptr</span><span class="pun">=</span><span class="lit">0</span></code></li><li class="L4"><code><span class="pln"> options</span><span class="pun">=[]</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="typ">Raw</span><span class="pln"> load</span><span class="pun">=</span><span class="str">'GET /index.html HTTP/1.0 \n\n'</span><span class="pln"> </span><span class="pun">|&gt;&gt;&gt;&gt;</span></code></li></ol></pre><p data-anchor-id="h5ya"><a href="https://jingyan.baidu.com/article/2f9b480dac4e8d41cb6cc2c9.html" target="_blank">“ping 域名”</a>即可得到网站的IP地址；“arp -a”可以查看网关的MAC地址。 <br>
在发送的数据包中，所有字段都有相应的值填充，主要是根据数据包a的设置填充的。如果嫌完整信息比较冗余，可以使用 <strong>“hide_defaults() ”</strong> 删除与默认值相同的字段。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="667u"><ol class="linenums"><li class="L0"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">hide_defaults</span><span class="pun">()</span></code></li><li class="L1"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> c</span></code></li><li class="L2"><code><span class="pun">&lt;</span><span class="typ">Ether</span><span class="pln"> dst</span><span class="pun">=</span><span class="lit">00</span><span class="pun">:</span><span class="lit">0f</span><span class="pun">:</span><span class="lit">66</span><span class="pun">:</span><span class="lit">56</span><span class="pun">:</span><span class="pln">fa</span><span class="pun">:</span><span class="pln">d2 src</span><span class="pun">=</span><span class="lit">00</span><span class="pun">:</span><span class="pln">ae</span><span class="pun">:</span><span class="pln">f3</span><span class="pun">:</span><span class="lit">52</span><span class="pun">:</span><span class="pln">aa</span><span class="pun">:</span><span class="pln">d1 type</span><span class="pun">=</span><span class="lit">0x800</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">IP ihl</span><span class="pun">=</span><span class="lit">5L</span><span class="pln"> len</span><span class="pun">=</span><span class="lit">67</span></code></li><li class="L3"><code><span class="pln"> frag</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">TCP chksum</span><span class="pun">=</span><span class="lit">0x783c</span><span class="pln"> src</span><span class="pun">=</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">5.21</span><span class="pln"> dst</span><span class="pun">=</span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.151</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">TCP dataofs</span><span class="pun">=</span><span class="lit">5L</span></code></li><li class="L4"><code><span class="pln"> chksum</span><span class="pun">=</span><span class="lit">0xbb39</span><span class="pln"> options</span><span class="pun">=[]</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="typ">Raw</span><span class="pln"> load</span><span class="pun">=</span><span class="str">'GET /index.html HTTP/1.0 \n\n'</span><span class="pln"> </span><span class="pun">|&gt;&gt;&gt;&gt;</span></code></li></ol></pre><p data-anchor-id="3iqx">3、读<a href="https://blog.csdn.net/u013793399/article/details/51474831" target="_blank">PCAP</a>文件</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="06yo"><ol class="linenums"><li class="L0"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> a</span><span class="pun">=</span><span class="pln">rdpcap</span><span class="pun">(</span><span class="str">"/spare/captures/isakmp.cap"</span><span class="pun">)</span><span class="pln">      </span><span class="com">//“”中为文件绝对路径</span></code></li><li class="L1"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> a</span></code></li><li class="L2"><code><span class="pun">&lt;</span><span class="pln">isakmp</span><span class="pun">.</span><span class="pln">cap</span><span class="pun">:</span><span class="pln"> UDP</span><span class="pun">:</span><span class="lit">721</span><span class="pln"> TCP</span><span class="pun">:</span><span class="lit">0</span><span class="pln"> ICMP</span><span class="pun">:</span><span class="lit">0</span><span class="pln"> </span><span class="typ">Other</span><span class="pun">:</span><span class="lit">0</span><span class="pun">&gt;</span><span class="pln">      </span><span class="com">//显示一个统计信息</span></code></li></ol></pre><p data-anchor-id="zc9l">4、生成一系列数据包</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="s3cn"><ol class="linenums"><li class="L0"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> a</span><span class="pun">=</span><span class="pln">IP</span><span class="pun">(</span><span class="pln">dst</span><span class="pun">=</span><span class="str">"www.slashdot.org/30"</span><span class="pun">)</span><span class="pln">     </span><span class="com">//“/30”表示子网掩码，即修改“www.slashdot.org”对应的IP地址的后两位</span></code></li><li class="L1"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> a</span></code></li><li class="L2"><code><span class="pun">&lt;</span><span class="pln">IP  dst</span><span class="pun">=</span><span class="typ">Net</span><span class="pun">(</span><span class="str">'www.slashdot.org/30'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">|&gt;</span></code></li><li class="L3"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="pun">[</span><span class="pln">p </span><span class="kwd">for</span><span class="pln"> p </span><span class="kwd">in</span><span class="pln"> a</span><span class="pun">]</span><span class="pln">      </span><span class="com">//将IP地址赋值给所有IP数据包的目的IP。根据IP地址数量只有4个IP数据包</span></code></li><li class="L4"><code><span class="pun">[&lt;</span><span class="pln">IP dst</span><span class="pun">=</span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.148</span><span class="pln"> </span><span class="pun">|&gt;,</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP dst</span><span class="pun">=</span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.149</span><span class="pln"> </span><span class="pun">|&gt;,</span></code></li><li class="L5"><code><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP dst</span><span class="pun">=</span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.150</span><span class="pln"> </span><span class="pun">|&gt;,</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP dst</span><span class="pun">=</span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.151</span><span class="pln"> </span><span class="pun">|&gt;]</span></code></li><li class="L6"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> b</span><span class="pun">=</span><span class="pln">IP</span><span class="pun">(</span><span class="pln">ttl</span><span class="pun">=[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,(</span><span class="lit">5</span><span class="pun">,</span><span class="lit">9</span><span class="pun">)])</span><span class="pln">       </span><span class="com">//设置IP数据包中的TTL字段数值，（）表示范围</span></code></li><li class="L7"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> b</span></code></li><li class="L8"><code><span class="pun">&lt;</span><span class="pln">IP ttl</span><span class="pun">=[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">9</span><span class="pun">)]</span><span class="pln"> </span><span class="pun">|&gt;</span></code></li><li class="L9"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="pun">[</span><span class="pln">p </span><span class="kwd">for</span><span class="pln"> p </span><span class="kwd">in</span><span class="pln"> b</span><span class="pun">]</span><span class="pln">      </span><span class="com">//将TTL值赋值给IP数据包。根据TTL数量产生IP数据包</span></code></li><li class="L0"><code><span class="pun">[&lt;</span><span class="pln">IP ttl</span><span class="pun">=</span><span class="lit">1</span><span class="pln"> </span><span class="pun">|&gt;,</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP ttl</span><span class="pun">=</span><span class="lit">2</span><span class="pln"> </span><span class="pun">|&gt;,</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP ttl</span><span class="pun">=</span><span class="lit">5</span><span class="pln"> </span><span class="pun">|&gt;,</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP ttl</span><span class="pun">=</span><span class="lit">6</span><span class="pln"> </span><span class="pun">|&gt;,</span></code></li><li class="L1"><code><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP ttl</span><span class="pun">=</span><span class="lit">7</span><span class="pln"> </span><span class="pun">|&gt;,</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP ttl</span><span class="pun">=</span><span class="lit">8</span><span class="pln"> </span><span class="pun">|&gt;,</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP ttl</span><span class="pun">=</span><span class="lit">9</span><span class="pln"> </span><span class="pun">|&gt;]</span></code></li><li class="L2"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> c</span><span class="pun">=</span><span class="pln">TCP</span><span class="pun">(</span><span class="pln">dport</span><span class="pun">=[</span><span class="lit">80</span><span class="pun">,</span><span class="lit">443</span><span class="pun">])</span><span class="pln">       </span><span class="com">//指定TCP的端口</span></code></li><li class="L3"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="pun">[</span><span class="pln">p </span><span class="kwd">for</span><span class="pln"> p </span><span class="kwd">in</span><span class="pln"> a</span><span class="pun">/</span><span class="pln">c</span><span class="pun">]</span><span class="pln">        </span><span class="com">//将端口号赋值给数据包a中的c包</span></code></li><li class="L4"><code><span class="pun">[&lt;</span><span class="pln">IP frag</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">TCP dst</span><span class="pun">=</span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.148</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">TCP dport</span><span class="pun">=</span><span class="lit">80</span><span class="pln"> </span><span class="pun">|&gt;&gt;,</span></code></li><li class="L5"><code><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP frag</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">TCP dst</span><span class="pun">=</span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.148</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">TCP dport</span><span class="pun">=</span><span class="lit">443</span><span class="pln"> </span><span class="pun">|&gt;&gt;,</span></code></li><li class="L6"><code><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP frag</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">TCP dst</span><span class="pun">=</span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.149</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">TCP dport</span><span class="pun">=</span><span class="lit">80</span><span class="pln"> </span><span class="pun">|&gt;&gt;,</span></code></li><li class="L7"><code><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP frag</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">TCP dst</span><span class="pun">=</span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.149</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">TCP dport</span><span class="pun">=</span><span class="lit">443</span><span class="pln"> </span><span class="pun">|&gt;&gt;,</span></code></li><li class="L8"><code><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP frag</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">TCP dst</span><span class="pun">=</span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.150</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">TCP dport</span><span class="pun">=</span><span class="lit">80</span><span class="pln"> </span><span class="pun">|&gt;&gt;,</span></code></li><li class="L9"><code><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP frag</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">TCP dst</span><span class="pun">=</span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.150</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">TCP dport</span><span class="pun">=</span><span class="lit">443</span><span class="pln"> </span><span class="pun">|&gt;&gt;,</span></code></li><li class="L0"><code><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP frag</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">TCP dst</span><span class="pun">=</span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.151</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">TCP dport</span><span class="pun">=</span><span class="lit">80</span><span class="pln"> </span><span class="pun">|&gt;&gt;,</span></code></li><li class="L1"><code><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">IP frag</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">TCP dst</span><span class="pun">=</span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.151</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">TCP dport</span><span class="pun">=</span><span class="lit">443</span><span class="pln"> </span><span class="pun">|&gt;&gt;]</span></code></li></ol></pre><p data-anchor-id="k7n7">5、发送数据包 <br>
send()：发送一个3层数据包，可以处理路由和2层数据。 <br>
sendp()：只能处理2层数据包。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="612c"><ol class="linenums"><li class="L0"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> send</span><span class="pun">(</span><span class="pln">IP</span><span class="pun">(</span><span class="pln">dst</span><span class="pun">=</span><span class="str">"1.2.3.4"</span><span class="pun">)/</span><span class="pln">ICMP</span><span class="pun">())</span></code></li><li class="L1"><code><span class="pun">.</span></code></li><li class="L2"><code><span class="typ">Sent</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> packets</span><span class="pun">.</span></code></li><li class="L3"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> sendp</span><span class="pun">(</span><span class="typ">Ether</span><span class="pun">()/</span><span class="pln">IP</span><span class="pun">(</span><span class="pln">dst</span><span class="pun">=</span><span class="str">"1.2.3.4"</span><span class="pun">,</span><span class="pln">ttl</span><span class="pun">=(</span><span class="lit">1</span><span class="pun">,</span><span class="lit">4</span><span class="pun">)),</span><span class="pln"> iface</span><span class="pun">=</span><span class="str">"eth1"</span><span class="pun">)</span><span class="pln">        </span><span class="com">//iface指定本机的网卡，TTL表明一共有4个数据包</span></code></li><li class="L4"><code><span class="pun">....</span></code></li><li class="L5"><code><span class="typ">Sent</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> packets</span><span class="pun">.</span></code></li><li class="L6"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> sendp</span><span class="pun">(</span><span class="str">"I'm travelling on Ethernet"</span><span class="pun">,</span><span class="pln"> iface</span><span class="pun">=</span><span class="str">"eth1"</span><span class="pun">,</span><span class="pln"> loop</span><span class="pun">=</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> inter</span><span class="pun">=</span><span class="lit">0.2</span><span class="pun">)</span><span class="pln">      </span><span class="com">//从网卡“eth1”上，每间隔0.2s，发送一个2层数据包</span></code></li><li class="L7"><code><span class="pun">................^</span><span class="pln">C</span></code></li><li class="L8"><code><span class="typ">Sent</span><span class="pln"> </span><span class="lit">16</span><span class="pln"> packets</span><span class="pun">.</span></code></li><li class="L9"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> sendp</span><span class="pun">(</span><span class="pln">rdpcap</span><span class="pun">(</span><span class="str">"/tmp/pcapfile"</span><span class="pun">))</span><span class="pln"> </span><span class="com">//tcpreplay，发送pcap文件中的内容</span></code></li><li class="L0"><code><span class="pun">...........</span></code></li><li class="L1"><code><span class="typ">Sent</span><span class="pln"> </span><span class="lit">11</span><span class="pln"> packets</span><span class="pun">.</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="typ">Returns</span><span class="pln"> packets sent </span><span class="kwd">by</span><span class="pln"> send</span><span class="pun">()</span></code></li><li class="L4"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> send</span><span class="pun">(</span><span class="pln">IP</span><span class="pun">(</span><span class="pln">dst</span><span class="pun">=</span><span class="str">'127.0.0.1'</span><span class="pun">),</span><span class="pln"> return_packets</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">)</span><span class="pln">      </span><span class="com">//给自己发数据</span></code></li><li class="L5"><code><span class="pun">.</span></code></li><li class="L6"><code><span class="typ">Sent</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> packets</span><span class="pun">.</span></code></li><li class="L7"><code><span class="pun">&lt;</span><span class="typ">PacketList</span><span class="pun">:</span><span class="pln"> TCP</span><span class="pun">:</span><span class="lit">0</span><span class="pln"> UDP</span><span class="pun">:</span><span class="lit">0</span><span class="pln"> ICMP</span><span class="pun">:</span><span class="lit">0</span><span class="pln"> </span><span class="typ">Other</span><span class="pun">:</span><span class="lit">1</span><span class="pun">&gt;</span></code></li></ol></pre><p data-anchor-id="oto6">6、模糊化 <br>
fuzz()函数可以改变任何不需要计算的默认值，这样可以快速部署模糊测试模板并发送它们。如果在IP层使用fuzz()函数，源地址和目的地址不会随机化，到那时可以使用RandIP()实现该功能。在下面的示例中，IP层正常，而UDP和NTP层模糊。 UDP校验和将是正确的，目的端口为NTP使用的123好端口，并且NTP版本将被强制为4。所有其他端口将被随机分配。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="2u8q"><ol class="linenums"><li class="L0"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> send</span><span class="pun">(</span><span class="pln">IP</span><span class="pun">(</span><span class="pln">dst</span><span class="pun">=</span><span class="str">"127.0.0.1"</span><span class="pun">)/</span><span class="pln">fuzz</span><span class="pun">(</span><span class="pln">UDP</span><span class="pun">()/</span><span class="pln">NTP</span><span class="pun">(</span><span class="pln">version</span><span class="pun">=</span><span class="lit">4</span><span class="pun">)),</span><span class="pln">loop</span><span class="pun">=</span><span class="lit">1</span><span class="pun">)</span></code></li><li class="L1"><code><span class="pun">................^</span><span class="pln">C</span></code></li><li class="L2"><code><span class="typ">Sent</span><span class="pln"> </span><span class="lit">16</span><span class="pln"> packets</span><span class="pun">.</span></code></li></ol></pre><p data-anchor-id="3egs">7、发送和接收数据包 <br>
sr()函数用于发送数据包并接收响应数据包。sr1()只返回一个响应数据包，且必为3层数据包【IP,ARP】；srp()只返回一个二层的响应数据包【Ethernet,802.3】。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="xiqq"><ol class="linenums"><li class="L0"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> sr1</span><span class="pun">(</span><span class="pln">IP</span><span class="pun">(</span><span class="pln">dst</span><span class="pun">=</span><span class="str">"www.slashdot.org"</span><span class="pun">)/</span><span class="pln">ICMP</span><span class="pun">()/</span><span class="str">"XXXXXXXXXXX"</span><span class="pun">)</span><span class="pln"> </span><span class="com">//发送该IP数据包，并接收响应数据包，并将响应数据包放入p中</span></code></li><li class="L1"><code><span class="typ">Begin</span><span class="pln"> emission</span><span class="pun">:</span></code></li><li class="L2"><code><span class="pun">...</span><span class="typ">Finished</span><span class="pln"> to send </span><span class="lit">1</span><span class="pln"> packets</span><span class="pun">.</span></code></li><li class="L3"><code><span class="pun">.*</span></code></li><li class="L4"><code><span class="typ">Received</span><span class="pln"> </span><span class="lit">5</span><span class="pln"> packets</span><span class="pun">,</span><span class="pln"> got </span><span class="lit">1</span><span class="pln"> answers</span><span class="pun">,</span><span class="pln"> remaining </span><span class="lit">0</span><span class="pln"> packets</span></code></li><li class="L5"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> p       </span><span class="com">//显示p</span></code></li><li class="L6"><code><span class="pun">&lt;</span><span class="pln">IP version</span><span class="pun">=</span><span class="lit">4L</span><span class="pln"> ihl</span><span class="pun">=</span><span class="lit">5L</span><span class="pln"> tos</span><span class="pun">=</span><span class="lit">0x0</span><span class="pln"> len</span><span class="pun">=</span><span class="lit">39</span><span class="pln"> id</span><span class="pun">=</span><span class="lit">15489</span><span class="pln"> flags</span><span class="pun">=</span><span class="pln"> frag</span><span class="pun">=</span><span class="lit">0L</span><span class="pln"> ttl</span><span class="pun">=</span><span class="lit">42</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">ICMP</span></code></li><li class="L7"><code><span class="pln"> chksum</span><span class="pun">=</span><span class="lit">0x51dd</span><span class="pln"> src</span><span class="pun">=</span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.151</span><span class="pln"> dst</span><span class="pun">=</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">5.21</span><span class="pln"> options</span><span class="pun">=</span><span class="str">''</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">ICMP type</span><span class="pun">=</span><span class="pln">echo</span><span class="pun">-</span><span class="pln">reply</span></code></li><li class="L8"><code><span class="pln"> code</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> chksum</span><span class="pun">=</span><span class="lit">0xee45</span><span class="pln"> id</span><span class="pun">=</span><span class="lit">0x0</span><span class="pln"> seq</span><span class="pun">=</span><span class="lit">0x0</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="typ">Raw</span><span class="pln"> load</span><span class="pun">=</span><span class="str">'XXXXXXXXXXX'</span></code></li><li class="L9"><code><span class="pln"> </span><span class="pun">|&lt;</span><span class="typ">Padding</span><span class="pln"> load</span><span class="pun">=</span><span class="str">'\x00\x00\x00\x00'</span><span class="pln"> </span><span class="pun">|&gt;&gt;&gt;&gt;</span></code></li><li class="L0"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">show</span><span class="pun">()</span><span class="pln">        </span><span class="com">//层次清楚地显示p</span></code></li><li class="L1"><code><span class="pun">---[</span><span class="pln"> IP </span><span class="pun">]---</span><span class="pln">        </span><span class="com">//IP层的头部</span></code></li><li class="L2"><code><span class="pln">version   </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4L</span></code></li><li class="L3"><code><span class="pln">ihl       </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5L</span></code></li><li class="L4"><code><span class="pln">tos       </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0x0</span></code></li><li class="L5"><code><span class="pln">len       </span><span class="pun">=</span><span class="pln"> </span><span class="lit">39</span></code></li><li class="L6"><code><span class="pln">id        </span><span class="pun">=</span><span class="pln"> </span><span class="lit">15489</span></code></li><li class="L7"><code><span class="pln">flags     </span><span class="pun">=</span></code></li><li class="L8"><code><span class="pln">frag      </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0L</span></code></li><li class="L9"><code><span class="pln">ttl       </span><span class="pun">=</span><span class="pln"> </span><span class="lit">42</span></code></li><li class="L0"><code><span class="pln">proto     </span><span class="pun">=</span><span class="pln"> ICMP</span></code></li><li class="L1"><code><span class="pln">chksum    </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0x51dd</span></code></li><li class="L2"><code><span class="pln">src       </span><span class="pun">=</span><span class="pln"> </span><span class="lit">66.35</span><span class="pun">.</span><span class="lit">250.151</span></code></li><li class="L3"><code><span class="pln">dst       </span><span class="pun">=</span><span class="pln"> </span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">5.21</span></code></li><li class="L4"><code><span class="pln">options   </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span></code></li><li class="L5"><code><span class="pun">---[</span><span class="pln"> ICMP </span><span class="pun">]---</span><span class="pln">      </span><span class="com">//ICMP的头部</span></code></li><li class="L6"><code><span class="pln">   type      </span><span class="pun">=</span><span class="pln"> echo</span><span class="pun">-</span><span class="pln">reply</span></code></li><li class="L7"><code><span class="pln">   code      </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span></code></li><li class="L8"><code><span class="pln">   chksum    </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0xee45</span></code></li><li class="L9"><code><span class="pln">   id        </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0x0</span></code></li><li class="L0"><code><span class="pln">   seq       </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0x0</span></code></li><li class="L1"><code><span class="pun">---[</span><span class="pln"> </span><span class="typ">Raw</span><span class="pln"> </span><span class="pun">]---</span><span class="pln">       </span><span class="com">//其中的数据</span></code></li><li class="L2"><code><span class="pln">      load      </span><span class="pun">=</span><span class="pln"> </span><span class="str">'XXXXXXXXXXX'</span></code></li><li class="L3"><code><span class="pun">---[</span><span class="pln"> </span><span class="typ">Padding</span><span class="pln"> </span><span class="pun">]---</span><span class="pln">       </span><span class="com">//填充的数据</span></code></li><li class="L4"><code><span class="pln">         load      </span><span class="pun">=</span><span class="pln"> </span><span class="str">'\x00\x00\x00\x00'</span></code></li></ol></pre><p data-anchor-id="qfg3">DNS查询（rd = recursion desired，递归查询）</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="rvdo"><ol class="linenums"><li class="L0"><code><span class="pun">&gt;&gt;&gt;</span><span class="pln"> sr1</span><span class="pun">(</span><span class="pln">IP</span><span class="pun">(</span><span class="pln">dst</span><span class="pun">=</span><span class="str">"192.168.5.1"</span><span class="pun">)/</span><span class="pln">UDP</span><span class="pun">()/</span><span class="pln">DNS</span><span class="pun">(</span><span class="pln">rd</span><span class="pun">=</span><span class="lit">1</span><span class="pun">,</span><span class="pln">qd</span><span class="pun">=</span><span class="pln">DNSQR</span><span class="pun">(</span><span class="pln">qname</span><span class="pun">=</span><span class="str">"www.slashdot.org"</span><span class="pun">)))</span><span class="pln">      </span><span class="com">//IP-dst为本网络的DNS服务器，发送一个UDP数据包，递归查询qname="www.slashdot.org"的IP地址（未成功）</span></code></li><li class="L1"><code><span class="typ">Begin</span><span class="pln"> emission</span><span class="pun">:</span></code></li><li class="L2"><code><span class="typ">Finished</span><span class="pln"> to send </span><span class="lit">1</span><span class="pln"> packets</span><span class="pun">.</span></code></li><li class="L3"><code><span class="pun">..*</span></code></li><li class="L4"><code><span class="typ">Received</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> packets</span><span class="pun">,</span><span class="pln"> got </span><span class="lit">1</span><span class="pln"> answers</span><span class="pun">,</span><span class="pln"> remaining </span><span class="lit">0</span><span class="pln"> packets</span></code></li><li class="L5"><code><span class="pun">&lt;</span><span class="pln">IP version</span><span class="pun">=</span><span class="lit">4L</span><span class="pln"> ihl</span><span class="pun">=</span><span class="lit">5L</span><span class="pln"> tos</span><span class="pun">=</span><span class="lit">0x0</span><span class="pln"> len</span><span class="pun">=</span><span class="lit">78</span><span class="pln"> id</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> flags</span><span class="pun">=</span><span class="pln">DF frag</span><span class="pun">=</span><span class="lit">0L</span><span class="pln"> ttl</span><span class="pun">=</span><span class="lit">64</span><span class="pln"> proto</span><span class="pun">=</span><span class="pln">UDP chksum</span><span class="pun">=</span><span class="lit">0xaf38</span></code></li><li class="L6"><code><span class="pln"> src</span><span class="pun">=</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">5.1</span><span class="pln"> dst</span><span class="pun">=</span><span class="lit">192.168</span><span class="pun">.</span><span class="lit">5.21</span><span class="pln"> options</span><span class="pun">=</span><span class="str">''</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">UDP sport</span><span class="pun">=</span><span class="lit">53</span><span class="pln"> dport</span><span class="pun">=</span><span class="lit">53</span><span class="pln"> len</span><span class="pun">=</span><span class="lit">58</span><span class="pln"> chksum</span><span class="pun">=</span><span class="lit">0xd55d</span></code></li><li class="L7"><code><span class="pln"> </span><span class="pun">|&lt;</span><span class="pln">DNS id</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> qr</span><span class="pun">=</span><span class="lit">1L</span><span class="pln"> opcode</span><span class="pun">=</span><span class="pln">QUERY aa</span><span class="pun">=</span><span class="lit">0L</span><span class="pln"> tc</span><span class="pun">=</span><span class="lit">0L</span><span class="pln"> rd</span><span class="pun">=</span><span class="lit">1L</span><span class="pln"> ra</span><span class="pun">=</span><span class="lit">1L</span><span class="pln"> z</span><span class="pun">=</span><span class="lit">0L</span><span class="pln"> rcode</span><span class="pun">=</span><span class="pln">ok qdcount</span><span class="pun">=</span><span class="lit">1</span><span class="pln"> ancount</span><span class="pun">=</span><span class="lit">1</span></code></li><li class="L8"><code><span class="pln"> nscount</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> arcount</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> qd</span><span class="pun">=&lt;</span><span class="pln">DNSQR qname</span><span class="pun">=</span><span class="str">'www.slashdot.org.'</span><span class="pln"> qtype</span><span class="pun">=</span><span class="pln">A qclass</span><span class="pun">=</span><span class="pln">IN </span><span class="pun">|&gt;</span></code></li><li class="L9"><code><span class="pln"> an</span><span class="pun">=&lt;</span><span class="pln">DNSRR rrname</span><span class="pun">=</span><span class="str">'www.slashdot.org.'</span><span class="pln"> type</span><span class="pun">=</span><span class="pln">A rclass</span><span class="pun">=</span><span class="pln">IN ttl</span><span class="pun">=</span><span class="lit">3560L</span><span class="pln"> rdata</span><span class="pun">=</span><span class="str">'66.35.250.151'</span><span class="pln"> </span><span class="pun">|&gt;</span></code></li><li class="L0"><code><span class="pln"> ns</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> ar</span><span class="pun">=</span><span class="lit">0</span><span class="pln"> </span><span class="pun">|&lt;</span><span class="typ">Padding</span><span class="pln"> load</span><span class="pun">=</span><span class="str">'\xc6\x94\xc7\xeb'</span><span class="pln"> </span><span class="pun">|&gt;&gt;&gt;&gt;</span></code></li></ol></pre><p data-anchor-id="h8yg">sr()函数是scapy中比较重要的函数，其返回两个队列，一个是（发送的数据包，应答），一个是没有回答的数据包。</p></div>
</body>
</html>